<link rel="import" href="../iron-swipeable-pages/iron-swipeable-pages.html">
<link rel="import" href="../deko-details/deko-details.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-tabs/paper-tab.html">
<link rel="import" href="../deko-cards/deko-cards.html">
<link rel="import" href="../deko-river/deko-river.html">
<link rel="import" href="../deko-deks/deko-deks.html">
<link rel="import" href="../polymer/polymer.html">
<!--
  `<deko-pages></deko-pages>` deko-pages 4 pages - Deks - Cards - River - Details 
  @demo demo.html
-->
<dom-module id="deko-pages">
  <template>
    <style> 
      iron-swipeable-pages,
      iron-swipeable-pages > * {
        height: calc(100% - 25px);
      }
    </style>
    
    <paper-tabs selected="{{selected}}">
      <paper-tab>Cards</paper-tab>
      <paper-tab>
        <template is="dom-if" if="[[user]]">
          Details
        </template>
        <template is="dom-if" if="[[!user]]">
          login
        </template>
      </paper-tab>
    </paper-tabs>
    
    <iron-swipeable-pages selected="{{selected}}" threshold="0.2" no-cycle>
      <deko-cards ref="[[cards.ref]]" ></deko-cards>
      <deko-details ref="[[profileRef]]">
        <template is="dom-if" if="[[!user]]">
          <h2 on-tap="login" >login</h2>
        </template>
        <template is="dom-if" if="[[user]]">
          <div on-tap="logout">logout</div>
        </template>
      </deko-details>
    </iron-swipeable-pages>
  </template>
</dom-module>
<script>
  Polymer({
    is: "deko-pages",
    properties:{
      selected:{
        type:Number,
        value:2,
      },
      ref: {
        observer:"setRef",
      },
      route:{
        notify:true,
        observer: "setPage",
      },
    },
    setPage: function(route) {
      if (route && this.ref) {
        if ("cards" === location.hash.substr(1)) {
          this.selected = 1
        }
      }
    },
    setRef: function(profileRef) {
      if (profileRef) {
        this.cards = {ref: profileRef.collection("cards")}
      }
    },
    logout: function(e,d){
      this.fire("logout",d)
    },
    login: function(e,d){
      this.fire("login",d)
    },
  })
</script>
